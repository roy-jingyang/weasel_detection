{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Social Borrowing\n",
    "\n",
    "## Description\n",
    "\n",
    "When agents manage to get other agents to do (some of) their work for them without them being credited or acknowledged for it and without it being part of the work that these agents are expected to contribute to."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "DataTransformerRegistry.enable('vegafusion')"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import altair as alt\n",
    "alt.data_transformers.enable('vegafusion')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "log_name = 'propr_test'\n",
    "\n",
    "fn_logs = {\n",
    "    'bpic15': '../data/preproc/bpic15.csv',\n",
    "    'bpic15_ref': '../data/preproc/bpic15_train-70.csv',\n",
    "    'bpic15_test': '../data/preproc/bpic15_test-30.csv',\n",
    "\n",
    "    'bpic17': '../data/preproc/bpic2017.csv',\n",
    "\n",
    "    'propr': '../data/preproc/proprietary.csv',\n",
    "    'propr_ref': '../data/preproc/proprietary_train-70.csv',\n",
    "    'propr_test': '../data/preproc/proprietary_test-30.csv'\n",
    "}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>activity</th>\n",
       "      <th>case_id</th>\n",
       "      <th>start timestamp</th>\n",
       "      <th>complete timestamp</th>\n",
       "      <th>resource</th>\n",
       "      <th>Weekday</th>\n",
       "      <th>Cost</th>\n",
       "      <th>School holidays; 0 = no, 1 = yes</th>\n",
       "      <th>Approval; 1 = low risk to 4 = high risk</th>\n",
       "      <th>Type of loan; 0 = normal; 1 = special</th>\n",
       "      <th>_start timestamp</th>\n",
       "      <th>_complete timestamp</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Application_Processing_Branches</td>\n",
       "      <td>ID-799</td>\n",
       "      <td>25/02/2011 16:01</td>\n",
       "      <td>2011-02-25 16:10:00</td>\n",
       "      <td>070-6-05</td>\n",
       "      <td>Friday</td>\n",
       "      <td>1,02 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-02-25 16:01:00</td>\n",
       "      <td>2011-02-25 16:10:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>ID-940</td>\n",
       "      <td>25/02/2011 16:06</td>\n",
       "      <td>2011-02-25 16:19:00</td>\n",
       "      <td>070-9-2</td>\n",
       "      <td>Friday</td>\n",
       "      <td>1,02 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-02-25 16:06:00</td>\n",
       "      <td>2011-02-25 16:19:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>ID-1078</td>\n",
       "      <td>28/02/2011 8:28</td>\n",
       "      <td>2011-02-28 09:02:00</td>\n",
       "      <td>001-6-02</td>\n",
       "      <td>Monday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-02-28 08:28:00</td>\n",
       "      <td>2011-02-28 09:02:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>ID-546</td>\n",
       "      <td>28/02/2011 10:40</td>\n",
       "      <td>2011-02-28 10:45:00</td>\n",
       "      <td>080-10-03</td>\n",
       "      <td>Monday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-02-28 10:40:00</td>\n",
       "      <td>2011-02-28 10:45:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Application_Processing_Branches</td>\n",
       "      <td>ID-1457</td>\n",
       "      <td>28/02/2011 10:10</td>\n",
       "      <td>2011-02-28 10:55:00</td>\n",
       "      <td>070-7-06</td>\n",
       "      <td>Monday</td>\n",
       "      <td>1,02 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-02-28 10:10:00</td>\n",
       "      <td>2011-02-28 10:55:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5285</th>\n",
       "      <td>Approval_Branch</td>\n",
       "      <td>ID-496</td>\n",
       "      <td>31/05/2011 14:41</td>\n",
       "      <td>2011-05-31 16:11:00</td>\n",
       "      <td>001-7-03</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-31 14:41:00</td>\n",
       "      <td>2011-05-31 16:11:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5286</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>ID-1384</td>\n",
       "      <td>31/05/2011 16:20</td>\n",
       "      <td>2011-05-31 16:21:00</td>\n",
       "      <td>010-21-01</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-31 16:20:00</td>\n",
       "      <td>2011-05-31 16:21:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5287</th>\n",
       "      <td>Approval_Branch</td>\n",
       "      <td>ID-496</td>\n",
       "      <td>31/05/2011 16:29</td>\n",
       "      <td>2011-05-31 16:30:00</td>\n",
       "      <td>010-21-01</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-31 16:29:00</td>\n",
       "      <td>2011-05-31 16:30:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5288</th>\n",
       "      <td>Check_of_Documents</td>\n",
       "      <td>ID-99</td>\n",
       "      <td>31/05/2011 15:42</td>\n",
       "      <td>2011-05-31 16:30:00</td>\n",
       "      <td>010-23-06</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>1,02 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-31 15:42:00</td>\n",
       "      <td>2011-05-31 16:30:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5289</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>ID-101</td>\n",
       "      <td>31/05/2011 18:27</td>\n",
       "      <td>2011-05-31 18:29:00</td>\n",
       "      <td>000-3-01</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-31 18:27:00</td>\n",
       "      <td>2011-05-31 18:29:00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5290 rows × 12 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                             activity  case_id   start timestamp  \\\n",
       "0     Application_Processing_Branches   ID-799  25/02/2011 16:01   \n",
       "1                            Precheck   ID-940  25/02/2011 16:06   \n",
       "2                            Precheck  ID-1078   28/02/2011 8:28   \n",
       "3                            Precheck   ID-546  28/02/2011 10:40   \n",
       "4     Application_Processing_Branches  ID-1457  28/02/2011 10:10   \n",
       "...                               ...      ...               ...   \n",
       "5285                  Approval_Branch   ID-496  31/05/2011 14:41   \n",
       "5286                         Precheck  ID-1384  31/05/2011 16:20   \n",
       "5287                  Approval_Branch   ID-496  31/05/2011 16:29   \n",
       "5288               Check_of_Documents    ID-99  31/05/2011 15:42   \n",
       "5289                         Precheck   ID-101  31/05/2011 18:27   \n",
       "\n",
       "       complete timestamp   resource  Weekday               Cost  \\\n",
       "0     2011-02-25 16:10:00   070-6-05   Friday  1,02 € per minute   \n",
       "1     2011-02-25 16:19:00    070-9-2   Friday  1,02 € per minute   \n",
       "2     2011-02-28 09:02:00   001-6-02   Monday  0,87 € per minute   \n",
       "3     2011-02-28 10:45:00  080-10-03   Monday  0,87 € per minute   \n",
       "4     2011-02-28 10:55:00   070-7-06   Monday  1,02 € per minute   \n",
       "...                   ...        ...      ...                ...   \n",
       "5285  2011-05-31 16:11:00   001-7-03  Tuesday  0,87 € per minute   \n",
       "5286  2011-05-31 16:21:00  010-21-01  Tuesday  0,87 € per minute   \n",
       "5287  2011-05-31 16:30:00  010-21-01  Tuesday  0,87 € per minute   \n",
       "5288  2011-05-31 16:30:00  010-23-06  Tuesday  1,02 € per minute   \n",
       "5289  2011-05-31 18:29:00   000-3-01  Tuesday  0,87 € per minute   \n",
       "\n",
       "      School holidays; 0 = no, 1 = yes  \\\n",
       "0                                  0.0   \n",
       "1                                  0.0   \n",
       "2                                  0.0   \n",
       "3                                  0.0   \n",
       "4                                  0.0   \n",
       "...                                ...   \n",
       "5285                               0.0   \n",
       "5286                               0.0   \n",
       "5287                               0.0   \n",
       "5288                               0.0   \n",
       "5289                               0.0   \n",
       "\n",
       "      Approval; 1 = low risk to 4 = high risk  \\\n",
       "0                                         1.0   \n",
       "1                                         1.0   \n",
       "2                                         1.0   \n",
       "3                                         1.0   \n",
       "4                                         1.0   \n",
       "...                                       ...   \n",
       "5285                                      2.0   \n",
       "5286                                      2.0   \n",
       "5287                                      2.0   \n",
       "5288                                      2.0   \n",
       "5289                                      2.0   \n",
       "\n",
       "      Type of loan; 0 = normal; 1 = special     _start timestamp  \\\n",
       "0                                       0.0  2011-02-25 16:01:00   \n",
       "1                                       0.0  2011-02-25 16:06:00   \n",
       "2                                       0.0  2011-02-28 08:28:00   \n",
       "3                                       0.0  2011-02-28 10:40:00   \n",
       "4                                       0.0  2011-02-28 10:10:00   \n",
       "...                                     ...                  ...   \n",
       "5285                                    0.0  2011-05-31 14:41:00   \n",
       "5286                                    0.0  2011-05-31 16:20:00   \n",
       "5287                                    0.0  2011-05-31 16:29:00   \n",
       "5288                                    0.0  2011-05-31 15:42:00   \n",
       "5289                                    0.0  2011-05-31 18:27:00   \n",
       "\n",
       "      _complete timestamp  \n",
       "0     2011-02-25 16:10:00  \n",
       "1     2011-02-25 16:19:00  \n",
       "2     2011-02-28 09:02:00  \n",
       "3     2011-02-28 10:45:00  \n",
       "4     2011-02-28 10:55:00  \n",
       "...                   ...  \n",
       "5285  2011-05-31 16:11:00  \n",
       "5286  2011-05-31 16:21:00  \n",
       "5287  2011-05-31 16:30:00  \n",
       "5288  2011-05-31 16:30:00  \n",
       "5289  2011-05-31 18:29:00  \n",
       "\n",
       "[5290 rows x 12 columns]"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "log = pd.read_csv(fn_logs[log_name])\n",
    "log"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Social-SB-1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "# convert to timestamps to calculate case/activity duration\n",
    "\n",
    "log = log.sort_values(by='start timestamp')\n",
    "log['start timestamp'] = pd.to_datetime(log['start timestamp'], format='mixed', dayfirst=True)\n",
    "log['complete timestamp'] = pd.to_datetime(log['complete timestamp'], format='mixed', dayfirst=True)\n",
    "log['activity_duration_minutes'] = (\n",
    "    log['complete timestamp'] - log['start timestamp']\n",
    ").dt.total_seconds() / 60"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Determine the attendance of resources\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "res_attendance = dict()\n",
    "for res, events in log.groupby('resource'):\n",
    "    res_attendance[res] = [\n",
    "        pd.Interval(e['start timestamp'], e['complete timestamp'], closed='both')\n",
    "        for i, e in events.iterrows()\n",
    "    ]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Discover co-presence of resources\n",
    "\n",
    "- Direct co-presence: resources worked in the same case\n",
    "- Indirect co-presence: working time of resources overlap"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Calculate direct co-presence\n",
    "if True:\n",
    "    direct_coapp = []\n",
    "    for case, events in log.groupby('case_id'):\n",
    "        case_team = set(events['resource'].unique())\n",
    "        for i, e in events.iterrows():\n",
    "            direct_coapp.append((\n",
    "                i, \n",
    "                ','.join(sorted(case_team.difference({e['resource']})))\n",
    "            ))\n",
    "    direct_coapp = pd.DataFrame(\n",
    "        direct_coapp, columns=['index', 'direct_copresenting_resources']\n",
    "    )\n",
    "    direct_coapp = direct_coapp.set_index(keys='index', drop=True)\n",
    "    log = pd.merge(log, direct_coapp, left_index=True, right_index=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Calculate indirect co-presence:\n",
    "if True:\n",
    "    all_resources = set(log['resource'].unique())\n",
    "    indirect_coapp = []\n",
    "    for res, events in log.groupby('resource'):\n",
    "        for i, e in events.iterrows():\n",
    "            overlapped_resources = set()\n",
    "            interval = pd.Interval(\n",
    "                e['start timestamp'], e['complete timestamp'], closed='both'\n",
    "            )\n",
    "            for other in all_resources.difference({res}):\n",
    "                for x in res_attendance[other]:\n",
    "                    if interval.overlaps(x):\n",
    "                        overlapped_resources.add(other)\n",
    "                        break\n",
    "            indirect_coapp.append((i, ','.join(sorted(overlapped_resources))))\n",
    "    indirect_coapp = pd.DataFrame(\n",
    "        indirect_coapp, columns=['index', 'indirect_copresenting_resources']\n",
    "    )\n",
    "    indirect_coapp = indirect_coapp.set_index(keys='index', drop=True)\n",
    "    log = pd.merge(log, indirect_coapp, left_index=True, right_index=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "# log.to_csv(fn_logs[log_name] + '.coapp.csv', index=False)\n",
    "# log = pd.read_csv(fn_logs[log_name] + '.coapp.csv')\n",
    "# log"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>activity</th>\n",
       "      <th>duration_q3</th>\n",
       "      <th>duration_q1</th>\n",
       "      <th>duration_ub_outlier</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Administrative_Tasks</td>\n",
       "      <td>39.00</td>\n",
       "      <td>4.00</td>\n",
       "      <td>91.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Application_Processing_Branches</td>\n",
       "      <td>38.00</td>\n",
       "      <td>3.00</td>\n",
       "      <td>90.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Approval</td>\n",
       "      <td>10.00</td>\n",
       "      <td>2.00</td>\n",
       "      <td>22.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Approval_Branch</td>\n",
       "      <td>40.00</td>\n",
       "      <td>4.00</td>\n",
       "      <td>94.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Approval_Executive_Board</td>\n",
       "      <td>1.00</td>\n",
       "      <td>1.00</td>\n",
       "      <td>1.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>Archieving</td>\n",
       "      <td>64.00</td>\n",
       "      <td>6.00</td>\n",
       "      <td>151.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>Check_of_Approval</td>\n",
       "      <td>26.50</td>\n",
       "      <td>9.00</td>\n",
       "      <td>52.750</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>Check_of_Documents</td>\n",
       "      <td>63.50</td>\n",
       "      <td>30.25</td>\n",
       "      <td>113.375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Check_of_Processing_Applications</td>\n",
       "      <td>12.00</td>\n",
       "      <td>2.00</td>\n",
       "      <td>27.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>End</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>Further_inquiry</td>\n",
       "      <td>1.50</td>\n",
       "      <td>0.50</td>\n",
       "      <td>3.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>Get_Signature_of_Customer</td>\n",
       "      <td>73.00</td>\n",
       "      <td>4.00</td>\n",
       "      <td>176.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>15.00</td>\n",
       "      <td>1.00</td>\n",
       "      <td>36.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>Preparation_Draft_Executive_Board</td>\n",
       "      <td>13.00</td>\n",
       "      <td>2.00</td>\n",
       "      <td>29.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>Preparation_Special_Processing</td>\n",
       "      <td>13.75</td>\n",
       "      <td>4.00</td>\n",
       "      <td>28.375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>Processing_Approval</td>\n",
       "      <td>22.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>55.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>Processing_Incomplete_Orders</td>\n",
       "      <td>2.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>5.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>Processing_Reply</td>\n",
       "      <td>2.50</td>\n",
       "      <td>1.50</td>\n",
       "      <td>4.000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>Processing_of_Applications</td>\n",
       "      <td>3.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>7.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>Processing_of_Applications_Sonderkredit</td>\n",
       "      <td>1.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>2.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>Refusal_Branches</td>\n",
       "      <td>8.75</td>\n",
       "      <td>1.00</td>\n",
       "      <td>20.375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>Revision</td>\n",
       "      <td>12.00</td>\n",
       "      <td>1.00</td>\n",
       "      <td>28.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>Rework_Branches</td>\n",
       "      <td>11.00</td>\n",
       "      <td>0.25</td>\n",
       "      <td>27.125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>Second_vote_KfW</td>\n",
       "      <td>26.00</td>\n",
       "      <td>1.00</td>\n",
       "      <td>63.500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>Trash</td>\n",
       "      <td>1.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>2.500</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                   activity  duration_q3  duration_q1  \\\n",
       "0                      Administrative_Tasks        39.00         4.00   \n",
       "1           Application_Processing_Branches        38.00         3.00   \n",
       "2                                  Approval        10.00         2.00   \n",
       "3                           Approval_Branch        40.00         4.00   \n",
       "4                  Approval_Executive_Board         1.00         1.00   \n",
       "5                                Archieving        64.00         6.00   \n",
       "6                         Check_of_Approval        26.50         9.00   \n",
       "7                        Check_of_Documents        63.50        30.25   \n",
       "8          Check_of_Processing_Applications        12.00         2.00   \n",
       "9                                       End         0.00         0.00   \n",
       "10                          Further_inquiry         1.50         0.50   \n",
       "11                Get_Signature_of_Customer        73.00         4.00   \n",
       "12                                 Precheck        15.00         1.00   \n",
       "13        Preparation_Draft_Executive_Board        13.00         2.00   \n",
       "14           Preparation_Special_Processing        13.75         4.00   \n",
       "15                      Processing_Approval        22.00         0.00   \n",
       "16             Processing_Incomplete_Orders         2.00         0.00   \n",
       "17                         Processing_Reply         2.50         1.50   \n",
       "18               Processing_of_Applications         3.00         0.00   \n",
       "19  Processing_of_Applications_Sonderkredit         1.00         0.00   \n",
       "20                         Refusal_Branches         8.75         1.00   \n",
       "21                                 Revision        12.00         1.00   \n",
       "22                          Rework_Branches        11.00         0.25   \n",
       "23                          Second_vote_KfW        26.00         1.00   \n",
       "24                                    Trash         1.00         0.00   \n",
       "\n",
       "    duration_ub_outlier  \n",
       "0                91.500  \n",
       "1                90.500  \n",
       "2                22.000  \n",
       "3                94.000  \n",
       "4                 1.000  \n",
       "5               151.000  \n",
       "6                52.750  \n",
       "7               113.375  \n",
       "8                27.000  \n",
       "9                 0.000  \n",
       "10                3.000  \n",
       "11              176.500  \n",
       "12               36.000  \n",
       "13               29.500  \n",
       "14               28.375  \n",
       "15               55.000  \n",
       "16                5.000  \n",
       "17                4.000  \n",
       "18                7.500  \n",
       "19                2.500  \n",
       "20               20.375  \n",
       "21               28.500  \n",
       "22               27.125  \n",
       "23               63.500  \n",
       "24                2.500  "
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# determine the activity duration distribution stats\n",
    "act_dur_stats = []\n",
    "for act, events in log.groupby('activity'):\n",
    "    act_dur_stats.append({\n",
    "        'activity': act,\n",
    "        'duration_q3': events['activity_duration_minutes'].quantile(0.75),\n",
    "        'duration_q1': events['activity_duration_minutes'].quantile(0.25),\n",
    "    })\n",
    "act_dur_stats = pd.DataFrame(act_dur_stats)\n",
    "act_dur_stats['duration_ub_outlier'] = (\n",
    "    act_dur_stats['duration_q3'] + \n",
    "    1.5 * (act_dur_stats['duration_q3'] - act_dur_stats['duration_q1'])\n",
    ")\n",
    "act_dur_stats"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>activity</th>\n",
       "      <th>case_id</th>\n",
       "      <th>start timestamp</th>\n",
       "      <th>complete timestamp</th>\n",
       "      <th>resource</th>\n",
       "      <th>Weekday</th>\n",
       "      <th>Cost</th>\n",
       "      <th>School holidays; 0 = no, 1 = yes</th>\n",
       "      <th>Approval; 1 = low risk to 4 = high risk</th>\n",
       "      <th>Type of loan; 0 = normal; 1 = special</th>\n",
       "      <th>_start timestamp</th>\n",
       "      <th>_complete timestamp</th>\n",
       "      <th>activity_duration_minutes</th>\n",
       "      <th>direct_copresenting_resources</th>\n",
       "      <th>indirect_copresenting_resources</th>\n",
       "      <th>duration_q3</th>\n",
       "      <th>duration_q1</th>\n",
       "      <th>duration_ub_outlier</th>\n",
       "      <th>is_low_performance</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>ID-270</td>\n",
       "      <td>2011-03-01 10:00:00</td>\n",
       "      <td>2011-03-01 10:05:00</td>\n",
       "      <td>001-7-03</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-03-01 10:00:00</td>\n",
       "      <td>2011-03-01 10:05:00</td>\n",
       "      <td>5.0</td>\n",
       "      <td>000-1-01,001-5-01,010-24-01,010-24-12,010-24-1...</td>\n",
       "      <td></td>\n",
       "      <td>15.00</td>\n",
       "      <td>1.0</td>\n",
       "      <td>36.000</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Check_of_Processing_Applications</td>\n",
       "      <td>ID-1619</td>\n",
       "      <td>2011-03-01 10:06:00</td>\n",
       "      <td>2011-03-01 10:07:00</td>\n",
       "      <td>000-2-01</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-03-01 10:06:00</td>\n",
       "      <td>2011-03-01 10:07:00</td>\n",
       "      <td>1.0</td>\n",
       "      <td>000-4-01,010-25-06,020-11-01</td>\n",
       "      <td></td>\n",
       "      <td>12.00</td>\n",
       "      <td>2.0</td>\n",
       "      <td>27.000</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Approval_Branch</td>\n",
       "      <td>ID-427</td>\n",
       "      <td>2011-03-01 10:34:00</td>\n",
       "      <td>2011-03-01 10:36:00</td>\n",
       "      <td>010-9-1</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-03-01 10:34:00</td>\n",
       "      <td>2011-03-01 10:36:00</td>\n",
       "      <td>2.0</td>\n",
       "      <td>010-23-07,010-23-13,010-8-1</td>\n",
       "      <td></td>\n",
       "      <td>40.00</td>\n",
       "      <td>4.0</td>\n",
       "      <td>94.000</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Application_Processing_Branches</td>\n",
       "      <td>ID-546</td>\n",
       "      <td>2011-03-01 10:38:00</td>\n",
       "      <td>2011-03-01 16:27:00</td>\n",
       "      <td>080-10-03</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-03-01 10:38:00</td>\n",
       "      <td>2011-03-01 16:27:00</td>\n",
       "      <td>349.0</td>\n",
       "      <td>010-23-13</td>\n",
       "      <td>000-1-01,000-2-01,000-3-01,000-4-02,010-24-13,...</td>\n",
       "      <td>38.00</td>\n",
       "      <td>3.0</td>\n",
       "      <td>90.500</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Refusal_Branches</td>\n",
       "      <td>ID-427</td>\n",
       "      <td>2011-03-01 10:39:00</td>\n",
       "      <td>2011-03-01 10:43:00</td>\n",
       "      <td>010-9-1</td>\n",
       "      <td>Tuesday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-03-01 10:39:00</td>\n",
       "      <td>2011-03-01 10:43:00</td>\n",
       "      <td>4.0</td>\n",
       "      <td>010-23-07,010-23-13,010-8-1</td>\n",
       "      <td>080-10-03</td>\n",
       "      <td>8.75</td>\n",
       "      <td>1.0</td>\n",
       "      <td>20.375</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5285</th>\n",
       "      <td>Get_Signature_of_Customer</td>\n",
       "      <td>ID-456</td>\n",
       "      <td>2011-05-09 09:42:00</td>\n",
       "      <td>2011-05-09 09:44:00</td>\n",
       "      <td>010-24-23</td>\n",
       "      <td>Monday</td>\n",
       "      <td>1,13 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>2011-05-09 09:42:00</td>\n",
       "      <td>2011-05-09 09:44:00</td>\n",
       "      <td>2.0</td>\n",
       "      <td>010-24-26,070-6-04</td>\n",
       "      <td>010-23-13,010-8-1</td>\n",
       "      <td>73.00</td>\n",
       "      <td>4.0</td>\n",
       "      <td>176.500</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5286</th>\n",
       "      <td>Precheck</td>\n",
       "      <td>ID-774</td>\n",
       "      <td>2011-05-09 09:43:00</td>\n",
       "      <td>2011-05-09 09:45:00</td>\n",
       "      <td>010-8-1</td>\n",
       "      <td>Monday</td>\n",
       "      <td>0,87 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-09 09:43:00</td>\n",
       "      <td>2011-05-09 09:45:00</td>\n",
       "      <td>2.0</td>\n",
       "      <td>010-23-06,010-23-13</td>\n",
       "      <td>010-23-13,010-24-23</td>\n",
       "      <td>15.00</td>\n",
       "      <td>1.0</td>\n",
       "      <td>36.000</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5287</th>\n",
       "      <td>Processing_of_Applications</td>\n",
       "      <td>ID-398</td>\n",
       "      <td>2011-05-09 09:49:00</td>\n",
       "      <td>2011-05-09 09:49:00</td>\n",
       "      <td>010-25-07</td>\n",
       "      <td>Monday</td>\n",
       "      <td>1,02 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-09 09:49:00</td>\n",
       "      <td>2011-05-09 09:49:00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>000-3-01,010-23-13,010-30-01,041-18-1</td>\n",
       "      <td>010-23-13</td>\n",
       "      <td>3.00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>7.500</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5288</th>\n",
       "      <td>Archieving</td>\n",
       "      <td>ID-398</td>\n",
       "      <td>2011-05-09 09:50:00</td>\n",
       "      <td>2011-05-09 09:51:00</td>\n",
       "      <td>010-25-07</td>\n",
       "      <td>Monday</td>\n",
       "      <td>1,02 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-09 09:50:00</td>\n",
       "      <td>2011-05-09 09:51:00</td>\n",
       "      <td>1.0</td>\n",
       "      <td>000-3-01,010-23-13,010-30-01,041-18-1</td>\n",
       "      <td>010-23-13</td>\n",
       "      <td>64.00</td>\n",
       "      <td>6.0</td>\n",
       "      <td>151.000</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5289</th>\n",
       "      <td>End</td>\n",
       "      <td>ID-398</td>\n",
       "      <td>2011-05-09 09:51:00</td>\n",
       "      <td>2011-05-09 09:51:00</td>\n",
       "      <td>010-25-07</td>\n",
       "      <td>Monday</td>\n",
       "      <td>1,02 € per minute</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2011-05-09 09:51:00</td>\n",
       "      <td>2011-05-09 09:51:00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>000-3-01,010-23-13,010-30-01,041-18-1</td>\n",
       "      <td>010-23-13</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5290 rows × 19 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                              activity  case_id     start timestamp  \\\n",
       "0                             Precheck   ID-270 2011-03-01 10:00:00   \n",
       "1     Check_of_Processing_Applications  ID-1619 2011-03-01 10:06:00   \n",
       "2                      Approval_Branch   ID-427 2011-03-01 10:34:00   \n",
       "3      Application_Processing_Branches   ID-546 2011-03-01 10:38:00   \n",
       "4                     Refusal_Branches   ID-427 2011-03-01 10:39:00   \n",
       "...                                ...      ...                 ...   \n",
       "5285         Get_Signature_of_Customer   ID-456 2011-05-09 09:42:00   \n",
       "5286                          Precheck   ID-774 2011-05-09 09:43:00   \n",
       "5287        Processing_of_Applications   ID-398 2011-05-09 09:49:00   \n",
       "5288                        Archieving   ID-398 2011-05-09 09:50:00   \n",
       "5289                               End   ID-398 2011-05-09 09:51:00   \n",
       "\n",
       "      complete timestamp   resource  Weekday               Cost  \\\n",
       "0    2011-03-01 10:05:00   001-7-03  Tuesday  0,87 € per minute   \n",
       "1    2011-03-01 10:07:00   000-2-01  Tuesday  0,87 € per minute   \n",
       "2    2011-03-01 10:36:00    010-9-1  Tuesday  0,87 € per minute   \n",
       "3    2011-03-01 16:27:00  080-10-03  Tuesday  0,87 € per minute   \n",
       "4    2011-03-01 10:43:00    010-9-1  Tuesday  0,87 € per minute   \n",
       "...                  ...        ...      ...                ...   \n",
       "5285 2011-05-09 09:44:00  010-24-23   Monday  1,13 € per minute   \n",
       "5286 2011-05-09 09:45:00    010-8-1   Monday  0,87 € per minute   \n",
       "5287 2011-05-09 09:49:00  010-25-07   Monday  1,02 € per minute   \n",
       "5288 2011-05-09 09:51:00  010-25-07   Monday  1,02 € per minute   \n",
       "5289 2011-05-09 09:51:00  010-25-07   Monday  1,02 € per minute   \n",
       "\n",
       "      School holidays; 0 = no, 1 = yes  \\\n",
       "0                                  0.0   \n",
       "1                                  0.0   \n",
       "2                                  0.0   \n",
       "3                                  0.0   \n",
       "4                                  0.0   \n",
       "...                                ...   \n",
       "5285                               0.0   \n",
       "5286                               0.0   \n",
       "5287                               0.0   \n",
       "5288                               0.0   \n",
       "5289                               0.0   \n",
       "\n",
       "      Approval; 1 = low risk to 4 = high risk  \\\n",
       "0                                         1.0   \n",
       "1                                         2.0   \n",
       "2                                         2.0   \n",
       "3                                         1.0   \n",
       "4                                         2.0   \n",
       "...                                       ...   \n",
       "5285                                      1.0   \n",
       "5286                                      1.0   \n",
       "5287                                      3.0   \n",
       "5288                                      3.0   \n",
       "5289                                      3.0   \n",
       "\n",
       "      Type of loan; 0 = normal; 1 = special     _start timestamp  \\\n",
       "0                                       0.0  2011-03-01 10:00:00   \n",
       "1                                       0.0  2011-03-01 10:06:00   \n",
       "2                                       0.0  2011-03-01 10:34:00   \n",
       "3                                       0.0  2011-03-01 10:38:00   \n",
       "4                                       0.0  2011-03-01 10:39:00   \n",
       "...                                     ...                  ...   \n",
       "5285                                    1.0  2011-05-09 09:42:00   \n",
       "5286                                    0.0  2011-05-09 09:43:00   \n",
       "5287                                    0.0  2011-05-09 09:49:00   \n",
       "5288                                    0.0  2011-05-09 09:50:00   \n",
       "5289                                    0.0  2011-05-09 09:51:00   \n",
       "\n",
       "      _complete timestamp  activity_duration_minutes  \\\n",
       "0     2011-03-01 10:05:00                        5.0   \n",
       "1     2011-03-01 10:07:00                        1.0   \n",
       "2     2011-03-01 10:36:00                        2.0   \n",
       "3     2011-03-01 16:27:00                      349.0   \n",
       "4     2011-03-01 10:43:00                        4.0   \n",
       "...                   ...                        ...   \n",
       "5285  2011-05-09 09:44:00                        2.0   \n",
       "5286  2011-05-09 09:45:00                        2.0   \n",
       "5287  2011-05-09 09:49:00                        0.0   \n",
       "5288  2011-05-09 09:51:00                        1.0   \n",
       "5289  2011-05-09 09:51:00                        0.0   \n",
       "\n",
       "                          direct_copresenting_resources  \\\n",
       "0     000-1-01,001-5-01,010-24-01,010-24-12,010-24-1...   \n",
       "1                          000-4-01,010-25-06,020-11-01   \n",
       "2                           010-23-07,010-23-13,010-8-1   \n",
       "3                                             010-23-13   \n",
       "4                           010-23-07,010-23-13,010-8-1   \n",
       "...                                                 ...   \n",
       "5285                                 010-24-26,070-6-04   \n",
       "5286                                010-23-06,010-23-13   \n",
       "5287              000-3-01,010-23-13,010-30-01,041-18-1   \n",
       "5288              000-3-01,010-23-13,010-30-01,041-18-1   \n",
       "5289              000-3-01,010-23-13,010-30-01,041-18-1   \n",
       "\n",
       "                        indirect_copresenting_resources  duration_q3  \\\n",
       "0                                                              15.00   \n",
       "1                                                              12.00   \n",
       "2                                                              40.00   \n",
       "3     000-1-01,000-2-01,000-3-01,000-4-02,010-24-13,...        38.00   \n",
       "4                                             080-10-03         8.75   \n",
       "...                                                 ...          ...   \n",
       "5285                                  010-23-13,010-8-1        73.00   \n",
       "5286                                010-23-13,010-24-23        15.00   \n",
       "5287                                          010-23-13         3.00   \n",
       "5288                                          010-23-13        64.00   \n",
       "5289                                          010-23-13         0.00   \n",
       "\n",
       "      duration_q1  duration_ub_outlier  is_low_performance  \n",
       "0             1.0               36.000               False  \n",
       "1             2.0               27.000               False  \n",
       "2             4.0               94.000               False  \n",
       "3             3.0               90.500                True  \n",
       "4             1.0               20.375               False  \n",
       "...           ...                  ...                 ...  \n",
       "5285          4.0              176.500               False  \n",
       "5286          1.0               36.000               False  \n",
       "5287          0.0                7.500               False  \n",
       "5288          6.0              151.000               False  \n",
       "5289          0.0                0.000               False  \n",
       "\n",
       "[5290 rows x 19 columns]"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "log = log.merge(act_dur_stats, how='left', on='activity')\n",
    "log['is_low_performance'] = (\n",
    "    log['activity_duration_minutes'] > log['duration_ub_outlier']\n",
    ")\n",
    "log"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Profile resource performance workload and productivity"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Find correlation between co-presence periods and decreased performance (and increased workload) of resources"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\yangj29\\AppData\\Local\\Temp\\ipykernel_27080\\723798934.py:18: RuntimeWarning: invalid value encountered in divide\n",
      "  coapp_low_perf /= coapp_all\n"
     ]
    }
   ],
   "source": [
    "all_resources = sorted(log['resource'].unique())\n",
    "col_copresenting_res = 'direct_copresenting_resources'\n",
    "coapp_normal = np.zeros((len(all_resources), len(all_resources)))\n",
    "coapp_low_perf = np.zeros((len(all_resources), len(all_resources)))\n",
    "log = log.fillna('')\n",
    "for res, events in log.groupby('resource'):\n",
    "    px = all_resources.index(res)\n",
    "    for i, e in events.iterrows():\n",
    "        if e[col_copresenting_res] != '':\n",
    "            for r in e[col_copresenting_res].split(','):\n",
    "                py = all_resources.index(r)\n",
    "                if e['is_low_performance']:\n",
    "                    coapp_low_perf[px,py] += 1\n",
    "                else:\n",
    "                    coapp_normal[px,py] += 1\n",
    "\n",
    "coapp_all = coapp_normal + coapp_low_perf\n",
    "coapp_low_perf /= coapp_all\n",
    "# convert matrices into dataframe\n",
    "coapp_all = pd.DataFrame.from_dict(coapp_all)\n",
    "coapp_all['resource'] = all_resources\n",
    "coapp_all = coapp_all.set_index('resource')\n",
    "coapp_all = coapp_all.rename(columns=dict(\n",
    "    (k, all_resources[k])\n",
    "    for k in range(len(all_resources))\n",
    "))\n",
    "coapp_all = coapp_all.reset_index().melt(id_vars='resource').rename(columns={'variable': 'copresenting_resource', 'value': 'num_while_copresenting'})\n",
    "coapp_all = coapp_all.replace(0, np.nan)\n",
    "# coapp_all\n",
    "\n",
    "coapp_low_perf = pd.DataFrame.from_dict(coapp_low_perf)\n",
    "coapp_low_perf['resource'] = all_resources\n",
    "coapp_low_perf = coapp_low_perf.set_index('resource')\n",
    "coapp_low_perf = coapp_low_perf.rename(columns=dict(\n",
    "    (k, all_resources[k]) \n",
    "    for k in range(len(all_resources))\n",
    "))\n",
    "coapp_low_perf = coapp_low_perf.reset_index().melt(id_vars='resource').rename(columns={'variable': 'copresenting_resource', 'value': 'pct_low_perf_while_copresenting'})\n",
    "coapp_low_perf = coapp_low_perf.replace(0, np.nan)\n",
    "# coapp_low_perf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "sel_resources = [\n",
    "    r for r in log['resource'].unique()\n",
    "    if r.startswith('010-24')\n",
    "]\n",
    "coapp_all = coapp_all[\n",
    "    (coapp_all['resource'].isin(sel_resources)) & \n",
    "    (coapp_all['copresenting_resource'].isin(sel_resources))\n",
    "]\n",
    "coapp_low_perf = coapp_low_perf[\n",
    "    (coapp_low_perf['resource'].isin(sel_resources)) & \n",
    "    (coapp_low_perf['copresenting_resource'].isin(sel_resources))\n",
    "]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "<style>\n",
       "  #altair-viz-c0648b4f6f36494c88a08724497619df.vega-embed {\n",
       "    width: 100%;\n",
       "    display: flex;\n",
       "  }\n",
       "\n",
       "  #altair-viz-c0648b4f6f36494c88a08724497619df.vega-embed details,\n",
       "  #altair-viz-c0648b4f6f36494c88a08724497619df.vega-embed details summary {\n",
       "    position: relative;\n",
       "  }\n",
       "</style>\n",
       "<div id=\"altair-viz-c0648b4f6f36494c88a08724497619df\"></div>\n",
       "<script type=\"text/javascript\">\n",
       "  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n",
       "  (function(spec, embedOpt){\n",
       "    let outputDiv = document.currentScript.previousElementSibling;\n",
       "    if (outputDiv.id !== \"altair-viz-c0648b4f6f36494c88a08724497619df\") {\n",
       "      outputDiv = document.getElementById(\"altair-viz-c0648b4f6f36494c88a08724497619df\");\n",
       "    }\n",
       "    const paths = {\n",
       "      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@5?noext\",\n",
       "      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n",
       "      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@5.16.3?noext\",\n",
       "      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@6?noext\",\n",
       "    };\n",
       "\n",
       "    function maybeLoadScript(lib, version) {\n",
       "      var key = `${lib.replace(\"-\", \"\")}_version`;\n",
       "      return (VEGA_DEBUG[key] == version) ?\n",
       "        Promise.resolve(paths[lib]) :\n",
       "        new Promise(function(resolve, reject) {\n",
       "          var s = document.createElement('script');\n",
       "          document.getElementsByTagName(\"head\")[0].appendChild(s);\n",
       "          s.async = true;\n",
       "          s.onload = () => {\n",
       "            VEGA_DEBUG[key] = version;\n",
       "            return resolve(paths[lib]);\n",
       "          };\n",
       "          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n",
       "          s.src = paths[lib];\n",
       "        });\n",
       "    }\n",
       "\n",
       "    function showError(err) {\n",
       "      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n",
       "      throw err;\n",
       "    }\n",
       "\n",
       "    function displayChart(vegaEmbed) {\n",
       "      vegaEmbed(outputDiv, spec, embedOpt)\n",
       "        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n",
       "    }\n",
       "\n",
       "    if(typeof define === \"function\" && define.amd) {\n",
       "      requirejs.config({paths});\n",
       "      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n",
       "    } else {\n",
       "      maybeLoadScript(\"vega\", \"5\")\n",
       "        .then(() => maybeLoadScript(\"vega-lite\", \"5.16.3\"))\n",
       "        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n",
       "        .catch(showError)\n",
       "        .then(() => displayChart(vegaEmbed));\n",
       "    }\n",
       "  })({\"$schema\": \"https://vega.github.io/schema/vega/v5.json\", \"data\": [{\"name\": \"source_0\", \"values\": [{\"copresenting_resource\": \"010-24-01\", \"num_while_copresenting\": 8.0, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-01\", \"num_while_copresenting\": 2.0, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-01\", \"num_while_copresenting\": 11.0, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-01\", \"num_while_copresenting\": 8.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-01\", \"num_while_copresenting\": 11.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-01\", \"num_while_copresenting\": 8.0, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-01\", \"num_while_copresenting\": 160.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-02\", \"num_while_copresenting\": 13.0, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-02\", \"num_while_copresenting\": 7.0, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-02\", \"num_while_copresenting\": 4.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-02\", \"num_while_copresenting\": 9.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-02\", \"num_while_copresenting\": 3.0, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-02\", \"num_while_copresenting\": 70.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-03\", \"num_while_copresenting\": 3.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-03\", \"num_while_copresenting\": 2.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-04\", \"num_while_copresenting\": 2.0, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-04\", \"num_while_copresenting\": 6.0, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-04\", \"num_while_copresenting\": 10.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-04\", \"num_while_copresenting\": 7.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-04\", \"num_while_copresenting\": 20.0, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-04\", \"num_while_copresenting\": 54.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-11\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-11\", \"num_while_copresenting\": 19.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-11\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-11\", \"num_while_copresenting\": 13.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-12\", \"num_while_copresenting\": 16.0, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-12\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-12\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-16\"}, {\"copresenting_resource\": \"010-24-12\", \"num_while_copresenting\": 5.0, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-12\", \"num_while_copresenting\": 12.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 35.0, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 11.0, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-03\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 13.0, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 6.0, \"resource\": \"010-24-11\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 5.0, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 27.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 15.0, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-13\", \"num_while_copresenting\": 62.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-16\", \"num_while_copresenting\": 10.0, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-16\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 19.0, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 2.0, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-03\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 4.0, \"resource\": \"010-24-11\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 12.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 10.0, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-17\", \"num_while_copresenting\": 66.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 9.0, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 2.0, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 17.0, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-11\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 6.0, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 6.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 13.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-23\", \"num_while_copresenting\": 91.0, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 326.0, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 138.0, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 99.0, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 12.0, \"resource\": \"010-24-11\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 43.0, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 45.0, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 1.0, \"resource\": \"010-24-16\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 142.0, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-26\", \"num_while_copresenting\": 197.0, \"resource\": \"010-24-23\"}]}, {\"name\": \"source_1\", \"values\": [{\"copresenting_resource\": \"010-24-01\", \"pct_low_perf_while_copresenting\": 0.375, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-01\", \"pct_low_perf_while_copresenting\": 0.09090909090909091, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-01\", \"pct_low_perf_while_copresenting\": 0.05625, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-02\", \"pct_low_perf_while_copresenting\": 0.07692307692307693, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-02\", \"pct_low_perf_while_copresenting\": 0.14285714285714285, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-02\", \"pct_low_perf_while_copresenting\": 0.1111111111111111, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-02\", \"pct_low_perf_while_copresenting\": 0.02857142857142857, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-04\", \"pct_low_perf_while_copresenting\": 0.1, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-04\", \"pct_low_perf_while_copresenting\": 0.2857142857142857, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-04\", \"pct_low_perf_while_copresenting\": 0.1, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-04\", \"pct_low_perf_while_copresenting\": 0.037037037037037035, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-11\", \"pct_low_perf_while_copresenting\": 0.05263157894736842, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-12\", \"pct_low_perf_while_copresenting\": 0.0625, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-13\", \"pct_low_perf_while_copresenting\": 0.2, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-13\", \"pct_low_perf_while_copresenting\": 0.18181818181818182, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-13\", \"pct_low_perf_while_copresenting\": 0.07692307692307693, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-13\", \"pct_low_perf_while_copresenting\": 0.2, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-13\", \"pct_low_perf_while_copresenting\": 0.037037037037037035, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-13\", \"pct_low_perf_while_copresenting\": 0.06666666666666667, \"resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-13\", \"pct_low_perf_while_copresenting\": 0.0967741935483871, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-16\", \"pct_low_perf_while_copresenting\": 0.3, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-17\", \"pct_low_perf_while_copresenting\": 0.10526315789473684, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-17\", \"pct_low_perf_while_copresenting\": 0.06060606060606061, \"resource\": \"010-24-26\"}, {\"copresenting_resource\": \"010-24-23\", \"pct_low_perf_while_copresenting\": 0.1111111111111111, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-23\", \"pct_low_perf_while_copresenting\": 0.11764705882352941, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-26\", \"pct_low_perf_while_copresenting\": 0.08588957055214724, \"resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-26\", \"pct_low_perf_while_copresenting\": 0.2391304347826087, \"resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-26\", \"pct_low_perf_while_copresenting\": 0.1414141414141414, \"resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-26\", \"pct_low_perf_while_copresenting\": 0.20930232558139536, \"resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-26\", \"pct_low_perf_while_copresenting\": 0.1111111111111111, \"resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-26\", \"pct_low_perf_while_copresenting\": 0.035211267605633804, \"resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-26\", \"pct_low_perf_while_copresenting\": 0.050761421319796954, \"resource\": \"010-24-23\"}]}, {\"name\": \"source_0_concat_0_x_domain_resource\", \"values\": [{\"resource\": \"010-24-02\"}, {\"resource\": \"010-24-04\"}, {\"resource\": \"010-24-12\"}, {\"resource\": \"010-24-13\"}, {\"resource\": \"010-24-17\"}, {\"resource\": \"010-24-23\"}, {\"resource\": \"010-24-26\"}, {\"resource\": \"010-24-01\"}, {\"resource\": \"010-24-16\"}, {\"resource\": \"010-24-03\"}, {\"resource\": \"010-24-11\"}]}, {\"name\": \"source_0_concat_0_y_domain_copresenting_resource\", \"values\": [{\"copresenting_resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-03\"}, {\"copresenting_resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-11\"}, {\"copresenting_resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-16\"}, {\"copresenting_resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-26\"}]}, {\"name\": \"source_0_concat_0_color_domain_num_while_copresenting\", \"values\": [{\"min\": 1.0, \"max\": 326.0}]}, {\"name\": \"source_1_concat_1_x_domain_resource\", \"values\": [{\"resource\": \"010-24-02\"}, {\"resource\": \"010-24-12\"}, {\"resource\": \"010-24-26\"}, {\"resource\": \"010-24-01\"}, {\"resource\": \"010-24-04\"}, {\"resource\": \"010-24-17\"}, {\"resource\": \"010-24-13\"}, {\"resource\": \"010-24-23\"}]}, {\"name\": \"source_1_concat_1_y_domain_copresenting_resource\", \"values\": [{\"copresenting_resource\": \"010-24-01\"}, {\"copresenting_resource\": \"010-24-02\"}, {\"copresenting_resource\": \"010-24-04\"}, {\"copresenting_resource\": \"010-24-11\"}, {\"copresenting_resource\": \"010-24-12\"}, {\"copresenting_resource\": \"010-24-13\"}, {\"copresenting_resource\": \"010-24-16\"}, {\"copresenting_resource\": \"010-24-17\"}, {\"copresenting_resource\": \"010-24-23\"}, {\"copresenting_resource\": \"010-24-26\"}]}, {\"name\": \"source_1_concat_1_color_domain_pct_low_perf_while_copresenting\", \"values\": [{\"min\": 0.02857142857142857, \"max\": 0.375}]}], \"signals\": [{\"name\": \"concat_0_x_step\", \"value\": 20}, {\"name\": \"concat_0_width\", \"update\": \"bandspace(domain('concat_0_x').length, 0, 0) * concat_0_x_step\"}, {\"name\": \"concat_0_y_step\", \"value\": 20}, {\"name\": \"concat_0_height\", \"update\": \"bandspace(domain('concat_0_y').length, 0, 0) * concat_0_y_step\"}, {\"name\": \"concat_1_x_step\", \"value\": 20}, {\"name\": \"concat_1_width\", \"update\": \"bandspace(domain('concat_1_x').length, 0, 0) * concat_1_x_step\"}, {\"name\": \"concat_1_y_step\", \"value\": 20}, {\"name\": \"concat_1_height\", \"update\": \"bandspace(domain('concat_1_y').length, 0, 0) * concat_1_y_step\"}], \"marks\": [{\"type\": \"group\", \"name\": \"concat_0_group\", \"encode\": {\"update\": {\"width\": {\"signal\": \"concat_0_width\"}, \"height\": {\"signal\": \"concat_0_height\"}}}, \"marks\": [{\"type\": \"rect\", \"name\": \"concat_0_marks\", \"from\": {\"data\": \"source_0\"}, \"encode\": {\"update\": {\"fill\": {\"field\": \"num_while_copresenting\", \"scale\": \"concat_0_color\"}, \"tooltip\": {\"signal\": \"{\\\"resource\\\": isValid(datum[\\\"resource\\\"]) ? datum[\\\"resource\\\"] : \\\"\\\"+datum[\\\"resource\\\"], \\\"copresenting_resource\\\": isValid(datum[\\\"copresenting_resource\\\"]) ? datum[\\\"copresenting_resource\\\"] : \\\"\\\"+datum[\\\"copresenting_resource\\\"], \\\"num_while_copresenting\\\": format(datum[\\\"num_while_copresenting\\\"], \\\"\\\")}\"}, \"description\": {\"signal\": \"\\\"resource: \\\" + (isValid(datum[\\\"resource\\\"]) ? datum[\\\"resource\\\"] : \\\"\\\"+datum[\\\"resource\\\"]) + \\\"; copresenting_resource: \\\" + (isValid(datum[\\\"copresenting_resource\\\"]) ? datum[\\\"copresenting_resource\\\"] : \\\"\\\"+datum[\\\"copresenting_resource\\\"]) + \\\"; num_while_copresenting: \\\" + (format(datum[\\\"num_while_copresenting\\\"], \\\"\\\"))\"}, \"x\": {\"field\": \"resource\", \"scale\": \"concat_0_x\"}, \"width\": {\"signal\": \"max(0.25, bandwidth('concat_0_x'))\"}, \"y\": {\"field\": \"copresenting_resource\", \"scale\": \"concat_0_y\"}, \"height\": {\"signal\": \"max(0.25, bandwidth('concat_0_y'))\"}}}, \"style\": [\"rect\"]}], \"axes\": [{\"scale\": \"concat_0_x\", \"labelBaseline\": \"middle\", \"zindex\": 1, \"grid\": false, \"title\": \"resource\", \"orient\": \"bottom\", \"labelAlign\": \"right\", \"labelAngle\": 270}, {\"scale\": \"concat_0_y\", \"zindex\": 1, \"title\": \"copresenting_resource\", \"grid\": false, \"orient\": \"left\"}], \"style\": \"cell\", \"legends\": [{\"fill\": \"concat_0_color\", \"gradientLength\": {\"signal\": \"clamp(concat_0_height, 64, 200)\"}, \"title\": \"num_while_copresenting\"}]}, {\"type\": \"group\", \"name\": \"concat_1_group\", \"encode\": {\"update\": {\"height\": {\"signal\": \"concat_1_height\"}, \"width\": {\"signal\": \"concat_1_width\"}}}, \"marks\": [{\"type\": \"rect\", \"name\": \"concat_1_marks\", \"from\": {\"data\": \"source_1\"}, \"encode\": {\"update\": {\"tooltip\": {\"signal\": \"{\\\"resource\\\": isValid(datum[\\\"resource\\\"]) ? datum[\\\"resource\\\"] : \\\"\\\"+datum[\\\"resource\\\"], \\\"copresenting_resource\\\": isValid(datum[\\\"copresenting_resource\\\"]) ? datum[\\\"copresenting_resource\\\"] : \\\"\\\"+datum[\\\"copresenting_resource\\\"], \\\"pct_low_perf_while_copresenting\\\": format(datum[\\\"pct_low_perf_while_copresenting\\\"], \\\"\\\")}\"}, \"description\": {\"signal\": \"\\\"resource: \\\" + (isValid(datum[\\\"resource\\\"]) ? datum[\\\"resource\\\"] : \\\"\\\"+datum[\\\"resource\\\"]) + \\\"; copresenting_resource: \\\" + (isValid(datum[\\\"copresenting_resource\\\"]) ? datum[\\\"copresenting_resource\\\"] : \\\"\\\"+datum[\\\"copresenting_resource\\\"]) + \\\"; pct_low_perf_while_copresenting: \\\" + (format(datum[\\\"pct_low_perf_while_copresenting\\\"], \\\"\\\"))\"}, \"x\": {\"field\": \"resource\", \"scale\": \"concat_1_x\"}, \"width\": {\"signal\": \"max(0.25, bandwidth('concat_1_x'))\"}, \"y\": {\"field\": \"copresenting_resource\", \"scale\": \"concat_1_y\"}, \"height\": {\"signal\": \"max(0.25, bandwidth('concat_1_y'))\"}, \"fill\": {\"field\": \"pct_low_perf_while_copresenting\", \"scale\": \"concat_1_color\"}}}, \"style\": [\"rect\"]}], \"axes\": [{\"scale\": \"concat_1_x\", \"zindex\": 1, \"grid\": false, \"labelAngle\": 270, \"title\": \"resource\", \"labelAlign\": \"right\", \"orient\": \"bottom\", \"labelBaseline\": \"middle\"}, {\"scale\": \"concat_1_y\", \"title\": \"copresenting_resource\", \"orient\": \"left\", \"zindex\": 1, \"grid\": false}], \"legends\": [{\"fill\": \"concat_1_color\", \"gradientLength\": {\"signal\": \"clamp(concat_1_height, 64, 200)\"}, \"title\": \"pct_low_perf_while_copresenting\"}], \"style\": \"cell\"}], \"scales\": [{\"name\": \"concat_0_x\", \"type\": \"band\", \"domain\": {\"data\": \"source_0_concat_0_x_domain_resource\", \"field\": \"resource\", \"sort\": true}, \"range\": {\"step\": {\"signal\": \"concat_0_x_step\"}}, \"paddingOuter\": 0, \"paddingInner\": 0}, {\"name\": \"concat_0_y\", \"type\": \"band\", \"domain\": {\"data\": \"source_0_concat_0_y_domain_copresenting_resource\", \"field\": \"copresenting_resource\", \"sort\": true}, \"range\": {\"step\": {\"signal\": \"concat_0_y_step\"}}, \"paddingInner\": 0, \"paddingOuter\": 0}, {\"name\": \"concat_0_color\", \"type\": \"linear\", \"domain\": [{\"signal\": \"(data(\\\"source_0_concat_0_color_domain_num_while_copresenting\\\")[0] || {}).min\"}, {\"signal\": \"(data(\\\"source_0_concat_0_color_domain_num_while_copresenting\\\")[0] || {}).max\"}], \"range\": {\"scheme\": \"lightgreyred\"}, \"interpolate\": \"hcl\", \"zero\": false}, {\"name\": \"concat_1_x\", \"type\": \"band\", \"domain\": {\"data\": \"source_1_concat_1_x_domain_resource\", \"field\": \"resource\", \"sort\": true}, \"range\": {\"step\": {\"signal\": \"concat_1_x_step\"}}, \"paddingInner\": 0, \"paddingOuter\": 0}, {\"name\": \"concat_1_y\", \"type\": \"band\", \"domain\": {\"data\": \"source_1_concat_1_y_domain_copresenting_resource\", \"field\": \"copresenting_resource\", \"sort\": true}, \"range\": {\"step\": {\"signal\": \"concat_1_y_step\"}}, \"paddingInner\": 0, \"paddingOuter\": 0}, {\"name\": \"concat_1_color\", \"type\": \"linear\", \"domain\": [{\"signal\": \"(data(\\\"source_1_concat_1_color_domain_pct_low_perf_while_copresenting\\\")[0] || {}).min\"}, {\"signal\": \"(data(\\\"source_1_concat_1_color_domain_pct_low_perf_while_copresenting\\\")[0] || {}).max\"}], \"range\": {\"scheme\": \"lightgreyred\"}, \"interpolate\": \"hcl\", \"zero\": false}], \"layout\": {\"padding\": 20, \"bounds\": \"full\", \"align\": \"each\"}, \"background\": \"white\", \"padding\": 5}, {\"mode\": \"vega\"});\n",
       "</script>"
      ],
      "text/plain": [
       "alt.HConcatChart(...)"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "alt.hconcat(\n",
    "    alt.Chart(coapp_all).mark_rect().encode(\n",
    "        x='resource:N',\n",
    "        y='copresenting_resource:N',\n",
    "        color=alt.Color('num_while_copresenting:Q').scale(scheme='lightgreyred'),\n",
    "        tooltip=['resource', 'copresenting_resource', 'num_while_copresenting']\n",
    "    ),\n",
    "    alt.Chart(coapp_low_perf).mark_rect().encode(\n",
    "        x='resource:N',\n",
    "        y='copresenting_resource:N',\n",
    "        color=alt.Color('pct_low_perf_while_copresenting:Q').scale(scheme='lightgreyred'),\n",
    "        tooltip=['resource', 'copresenting_resource', 'pct_low_perf_while_copresenting']\n",
    "    )\n",
    ").resolve_scale(color='independent')"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "pm",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
